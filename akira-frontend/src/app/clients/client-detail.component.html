<div class="container" *ngIf="client">
  <div class="header">
    <h2>Client: {{client.hostname}}</h2>
    <span class="status-badge" [class.status-ok]="client.status === 'OK'" [class.status-failed]="client.status === 'FAILED'">
      {{client.status}}
    </span>
  </div>

  <mat-tab-group>
    <mat-tab label="Messages">
      <div class="messages-container">
        
        <mat-form-field appearance="fill">
          <mat-label>Filter by Date</mat-label>
          <input matInput [matDatepicker]="picker" [formControl]="dateControl">
          <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
          <mat-datepicker #picker></mat-datepicker>
        </mat-form-field>

        <div class="table-container mat-elevation-z8">
          <table mat-table [dataSource]="messages">
            <ng-container matColumnDef="id">
              <th mat-header-cell *matHeaderCellDef> ID </th>
              <td mat-cell *matCellDef="let element"> {{element.id}} </td>
            </ng-container>

            <ng-container matColumnDef="message">
              <th mat-header-cell *matHeaderCellDef> Message </th>
              <td mat-cell *matCellDef="let element"> {{element.message}} </td>
            </ng-container>

            <ng-container matColumnDef="clientTimestamp">
              <th mat-header-cell *matHeaderCellDef> Client Timestamp </th>
              <td mat-cell *matCellDef="let element"> {{element.clientTimestamp | date:'medium'}} </td>
            </ng-container>

            <ng-container matColumnDef="receivedAt">
              <th mat-header-cell *matHeaderCellDef> Received At </th>
              <td mat-cell *matCellDef="let element"> {{element.receivedAt | date:'medium'}} </td>
            </ng-container>

            <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
            <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
          </table>

          <mat-paginator [length]="totalMessages"
                         [pageSize]="pageSize"
                         [pageIndex]="pageIndex"
                         [pageSizeOptions]="[5, 10, 20, 50]"
                         (page)="loadMessages($event)">
          </mat-paginator>
        </div>
      </div>
    </mat-tab>

    <mat-tab label="Stats">
      <div class="stats-container">
        <h3>Message Count by Hour (Today)</h3>
        <div class="histogram">
          <div class="bar-container" *ngFor="let stat of stats">
            <div class="bar" [style.height]="getBarHeight(stat.count)" [matTooltip]="stat.count + ' messages'"></div>
            <div class="label">{{stat.hour | number:'2.0'}}</div>
          </div>
        </div>
      </div>
    </mat-tab>
  </mat-tab-group>
</div>

